<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Tutorial: Deploy to AWS &middot; Go CDK</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,400i,700|Source+Code+Pro|Work+Sans:400,700">
  <link type="text/css" rel="stylesheet" href="/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/css/style.css">
  <link rel="shortcut icon" href="/favicon-32x32.png">
</head>
<body>
  <div class="PageLayout">
    <header class="PageHeader">
      <a href="https://gocloud.dev/"><h1 class="PageLogo"><img class="PageLogo-image" src="/go-cdk-logo-white.png" alt="Go CDK"></h1></a>
    </header>
    <main class="MainContent">
      <div class="MainContent-bounds"><h1>Tutorial: Deploy to AWS</h1>
<p>In this tutorial, we will deploy an existing Go CDK application called
Guestbook to Amazon Web Services (AWS).</p>

Guestbook is a sample application that records visitors&rsquo; messages and
displays a cloud banner with an administrative message. The main business
logic is written in a cloud-agnostic manner using MySQL, the generic blob
API, and the generic runtimevar API. All platform-specific code is set up by
<a href="https://github.com/google/wire">Wire</a>.

<h2 id="prerequisites">Prerequisites</h2>

<p>You will need to install the following software for this tutorial:</p>

<ul>
<li><a href="https://git-scm.com/">Git</a></li>
<li><a href="https://golang.org/doc/install">Go</a></li>
<li><a href="https://github.com/google/wire/blob/master/README.md#installing">Wire</a></li>
<li><a href="https://docs.docker.com/install/">Docker Desktop</a></li>
<li><a href="https://www.terraform.io/intro/getting-started/install.html">Terraform</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html">aws CLI</a></li>
</ul>

<h2 id="prerequisite-cloning-the-guestbook-sample">Prerequisite: Cloning the Guestbook Sample</h2>

<p>Before you can do anything else, you need to clone the Go CDK repository. The
repository contains the Guestbook sample.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">git clone https://github.com/google/go-cloud.git
<span class="nb">cd</span> go-cloud/samples/guestbook</code></pre></div>
<h2 id="building">Building</h2>

<p>Run the following in the <code>samples/guestbook</code> directory:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">go generate <span class="o">&amp;&amp;</span> go build</code></pre></div>
<h2 id="running-locally">Running Locally</h2>

<p>You will need to run a local MySQL database server and create a local message of
the day. <code>localdb/main.go</code> runs the local MySQL database server using Docker:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">go get ./localdb/... <span class="c1"># Get package dependencies.</span>
go run localdb/main.go</code></pre></div>
<p>In another terminal, run the <code>guestbook</code> application:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Set a local Message of the Day.</span>
<span class="nb">echo</span> <span class="s1">&#39;Hello, World!&#39;</span> &gt; motd.txt

<span class="c1"># Run the server.</span>
<span class="c1"># For blob, it uses fileblob, pointing at the local directory ./blobs.</span>
<span class="c1"># For runtimevar, it uses filevar, pointing at the local file ./motd.txt.</span>
<span class="c1">#   You can update the ./motd.txt while the server is running, refresh</span>
<span class="c1">#   the page, and see it change.</span>
./guestbook -env<span class="o">=</span><span class="nb">local</span> -bucket<span class="o">=</span>blobs -motd_var<span class="o">=</span>motd.txt</code></pre></div>
<p>Your server is now running on <a href="http://localhost:8080/">http://localhost:8080/</a>.</p>

<p>You can stop the MySQL database server with Ctrl-\. MySQL ignores Ctrl-C
(SIGINT).</p>


<h2 id="running-on-amazon-web-services-aws">Running on Amazon Web Services (AWS)</h2>

<p>If you want to run this sample on AWS, you need to set up an account, download
the AWS command line interface, and log in. There&rsquo;s <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">help here</a>
if you need it.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">aws configure</code></pre></div>
<h3 id="agree-to-the-debian-terms-and-conditions">Agree to the Debian Terms and Conditions</h3>

<p>You have to agree to the <a href="https://aws.amazon.com/marketplace/pp?sku=55q52qvgjfpdj2fpfy9mb1lo4">Debian Terms and Conditions</a> in order to
provision the resources. Click through the &ldquo;Continue to Subscribe&rdquo; button at the
top, then log in to your AWS account and subscribe to Debian.</p>

<h3 id="ssh-key">SSH Key</h3>

<p>You will also need an SSH key to SSH into the EC2 instance. If you don&rsquo;t already
have one, you can follow <a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/">this guide from GitHub</a>. Follow the
instructions for &ldquo;Adding your key to the ssh-agent&rdquo; if you want the key to
persist across terminal sessions.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">ssh-add</code></pre></div>
<h3 id="provision-resources-with-terraform">Provision resources with Terraform</h3>

<p>You can now use Terraform, a tool for initializing cloud resources, to set up
your project. This will create an EC2 instance you can SSH to and run your
binary.</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Build for deploying on the AWS Linux VM.</span>
<span class="nv">GOOS</span><span class="o">=</span>linux <span class="nv">GOARCH</span><span class="o">=</span>amd64 go build

<span class="c1"># Enter AWS directory from samples/guestbook.</span>
<span class="nb">cd</span> aws
terraform init

<span class="c1"># Provisioning can take up to 10 minutes.</span>
<span class="c1"># Keep track of the output of this command as it is needed later.</span>
<span class="c1"># You can replace us-west-1 with whatever region you want.</span>
terraform apply -var <span class="nv">region</span><span class="o">=</span>us-west-1 -var <span class="nv">ssh_public_key</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>cat ~/.ssh/id_rsa.pub<span class="k">)</span><span class="s2">&#34;</span></code></pre></div>
<h3 id="connect-to-the-new-server-and-run-the-guestbook-binary">Connect to the new server and run the guestbook binary</h3>

<p>You now need to connect to the new remote server to execute the <code>guestbook</code>
binary. The final output of <code>terraform apply</code> lists the variables <code>guestbook</code>
requires as arguments. Here&rsquo;s an example, with actual strings replaced with
<code>[redacted]</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Output from &#34;terraform apply&#34; command....</span>
&lt;snip&gt;

Outputs:

<span class="nv">bucket</span> <span class="o">=</span> <span class="o">[</span>redacted<span class="o">]</span>
<span class="nv">database_host</span> <span class="o">=</span> <span class="o">[</span>redacted<span class="o">]</span>
<span class="nv">database_root_password</span> <span class="o">=</span> &lt;sensitive&gt;
<span class="nv">instance_host</span> <span class="o">=</span> <span class="o">[</span>redacted<span class="o">]</span>
<span class="nv">paramstore_var</span> <span class="o">=</span> /guestbook/motd
<span class="nv">region</span> <span class="o">=</span> us-west-1

<span class="c1"># Print out the database root password, since we&#39;ll need it below</span>
<span class="c1"># Terraform hides it by default in the Outputs above.</span>
localhost$ terraform output database_root_password
<span class="o">[</span>redacted<span class="o">]</span>

<span class="c1"># SSH into the EC2 instance.</span>
localhost$ ssh <span class="s2">&#34;admin@</span><span class="k">$(</span> terraform output instance_host <span class="k">)</span><span class="s2">&#34;</span>

<span class="c1"># Fill in each command-line argument with the values from the</span>
<span class="c1"># Terraform output above.</span>
server$ <span class="nv">AWS_REGION</span><span class="o">=</span>&lt;your region&gt; ./guestbook <span class="se">\
</span><span class="se"></span>  -env<span class="o">=</span>aws <span class="se">\
</span><span class="se"></span>  -bucket<span class="o">=</span>&lt;your bucket&gt; <span class="se">\
</span><span class="se"></span>  -db_host<span class="o">=</span>&lt;your database_host&gt; <span class="se">\
</span><span class="se"></span>  -db_user<span class="o">=</span>root <span class="se">\
</span><span class="se"></span>  -db_password<span class="o">=</span>&lt;your database_root_password&gt; <span class="se">\
</span><span class="se"></span>  -motd_var<span class="o">=</span>/guestbook/motd</code></pre></div>
<h3 id="view-the-guestbook-application">View the guestbook application</h3>

<p>You can now visit the server at <code>http://&lt;your instance_host&gt;:8080/</code>.</p>

<h2 id="cleanup">Cleanup</h2>

<p>To clean up the created resources, run <code>terraform destroy</code> inside the <code>aws</code>
directory using the same variables you entered during <code>terraform apply</code>.</p>

<h2 id="gophers">Gophers</h2>

<p>The Go gopher was designed by Renee French and used under the
<a href="https://creativecommons.org/licenses/by/3.0/">Creative Commons 3.0 Attributions</a>
license.</div>
    </main>
    <nav class="Sidenav">
      <ul class="Sidenav-list">
        <li class="Sidenav-section">
          <a href="/" class="Sidenav-sectionLink">Home</a>
        </li>
        <li class="Sidenav-section">
          <a href="/tutorials/" class="Sidenav-sectionLink">Tutorials</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/tutorials/cli-uploader/" class="Sidenav-pageLink">Command-Line Uploader</a>
              </li>
              <li class="Sidenav-page">
                <a href="/tutorials/deploy-aws/" class="Sidenav-pageLink">Deploy to AWS</a>
              </li>
              <li class="Sidenav-page">
                <a href="/tutorials/deploy-gcp/" class="Sidenav-pageLink">Deploy to GCP</a>
              </li>
              <li class="Sidenav-page">
                <a href="/tutorials/deploy-azure/" class="Sidenav-pageLink">Connect to Azure</a>
              </li>
            </ul>
        </li>
        <li class="Sidenav-section">
          <a href="/ref/" class="Sidenav-sectionLink">Reference</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/ref/blob/" class="Sidenav-pageLink">Blob</a>
              </li>
              <li class="Sidenav-page">
                <a href="/ref/sql/" class="Sidenav-pageLink">MySQL/Postgres</a>
              </li>
              <li class="Sidenav-page">
                <a href="/ref/pubsub/" class="Sidenav-pageLink">Pubsub</a>
              </li>
              <li class="Sidenav-page">
                <a href="/ref/runtimevar/" class="Sidenav-pageLink">Runtimevar</a>
              </li>
              <li class="Sidenav-page">
                <a href="/ref/secrets/" class="Sidenav-pageLink">Secrets</a>
              </li>
              <li class="Sidenav-page">
                <a href="/ref/server/" class="Sidenav-pageLink">Server</a>
              </li>
            </ul>
        </li>
      </ul>
    </nav>
    <footer class="PageFooter">
      <nav>
        <ul class="FooterLinks">
          <li class="FooterLinks-item"><a href="https://github.com/google/go-cloud/" class="FooterLinks-link">GitHub</a></li>
          <li class="FooterLinks-item"><a href="https://groups.google.com/forum/#!forum/go-cloud" class="FooterLinks-link">Google Groups</a></li>
          <li class="FooterLinks-item"><a href="mailto:go-cdk-feedback@google.com" class="FooterLinks-link">Contact Team</a></li>
        </ul>
      </nav>

      <p class="PageFooter-paragraph">
        Copyright © 2018–2019 The Go Cloud Development Kit Authors.
        All content released under an <a href="https://github.com/google/go-cloud/blob/master/LICENSE" target="_blank" class="PageFooter-link">Apache 2.0 License</a>.
      </p>
      <p class="PageFooter-paragraph"><a href="https://github.com/google/go-cloud/edit/master/internal/website/content/tutorials/deploy-aws.md" class="PageFooter-link">Improve this page</a> on GitHub.</p>
    </footer>
  </div>
</body>
</html>
