<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Encrypt &amp; Decrypt Data &middot; Go CDK</title>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Source+Code+Pro|Work+Sans:400,700">
  <link type="text/css" rel="stylesheet" href="/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/css/style.css">
  <link rel="shortcut icon" href="/favicon-32x32.png">
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-135118641-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div class="PageLayout">
    <header class="PageHeader">
      <a href="https://gocloud.dev/"><h1 class="PageLogo"><img class="PageLogo-image" src="/go-cdk-logo-white.png" alt="Go CDK"></h1></a>
    </header>
    <main class="MainContent">
      <div class="MainContent-bounds"><h1>Encrypt &amp; Decrypt Data</h1>

<nav class="PageTOC">
  <div class="PageTOC-heading">In this article</div>
  <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#encrypt">Encrypting data</a></li>
<li><a href="#decrypt">Decrypting data</a></li>
<li><a href="#large-messages">Large Messages</a></li>
</ul></li>
</ul>
</nav>
</nav>

<p>Once you have <a href="https://gocloud.dev/howto/secrets/open-keeper/">opened a secrets keeper</a> for the secrets provider you want,
you can encrypt and decrypt small messages using the keeper.</p>

<h2 id="encrypt"> Encrypting data<a class="anchor" href="#encrypt" aria-label="Link to Section">ðŸ”—</a></h2>

<p>To encrypt data with a keeper, you call <code>Encrypt</code> with the byte slice you
want to encrypt.</p>

<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">plainText</span> <span class="o">:=</span> <span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&#34;Secrets secrets...&#34;</span><span class="p">)</span>
<span class="nx">cipherText</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">keeper</span><span class="p">.</span><span class="nf">Encrypt</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">plainText</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="decrypt"> Decrypting data<a class="anchor" href="#decrypt" aria-label="Link to Section">ðŸ”—</a></h2>

<p>To decrypt data with a keeper, you call <code>Decrypt</code> with the byte slice you
want to decrypt. This should be data that you obtained from a previous call
to <code>Encrypt</code> with a keeper that uses the same secret material (e.g. two AWS
KMS keepers created with the same customer master key ID). The <code>Decrypt</code>
method will return an error if the input data is corrupted.</p>

<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">cipherText</span> <span class="p">[]</span><span class="kt">byte</span> <span class="c1">// obtained from elsewhere and random-looking
</span><span class="c1"></span><span class="nx">plainText</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">keeper</span><span class="p">.</span><span class="nf">Decrypt</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">cipherText</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="large-messages"> Large Messages<a class="anchor" href="#large-messages" aria-label="Link to Section">ðŸ”—</a></h2>

<p>The secrets keeper API is designed to work with small messages (i.e. &lt;10 KiB
in length.) Cloud key management services are high latency; using them for
encrypting or decrypting large amounts of data is prohibitively slow (and in
some providers not permitted). If you need your application to encrypt or
decrypt large amounts of data, you should:</p>

<ol>
<li>Generate a key for the encryption algorithm (16KiB chunks with
<a href="https://godoc.org/golang.org/x/crypto/nacl/secretbox"><code>secretbox</code></a> is a reasonable approach).</li>
<li>Encrypt the key with secret keeper.</li>
<li>Store the encrypted key somewhere accessible to the application.</li>
</ol>

<p>When your application needs to encrypt or decrypt a large message:</p>

<ol>
<li>Decrypt the key from storage using the secret keeper</li>
<li>Use the decrypted key to encrypt or decrypt the message inside your
application.</li>
</ol></div>
    </main>
    <nav class="Sidenav">
      <ul class="Sidenav-list">
        <li class="Sidenav-section">
          <a href="/" class="Sidenav-sectionLink">Home</a>
        </li>
        <li class="Sidenav-section">
          <a href="/tutorials/" class="Sidenav-sectionLink">Tutorials</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/tutorials/cli-uploader/" class="Sidenav-pageLink">Command-Line Uploader</a>
              </li>
              <li class="Sidenav-page">
                <a href="/tutorials/guestbook/" class="Sidenav-pageLink">Guestbook</a>
              </li>
              
            </ul>
        </li>
        <li class="Sidenav-section">
          <a href="/howto/" class="Sidenav-sectionLink">How-To Guides</a>
            <ul class="Sidenav-pageList">
              
              <li class="Sidenav-page">
                <a href="/howto/blob/" class="Sidenav-pageLink">Blob</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/sql/" class="Sidenav-pageLink">MySQL/PostgreSQL</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/pubsub/" class="Sidenav-pageLink">Pub/Sub</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/runtimevar/" class="Sidenav-pageLink">Runtime Configuration</a>
              </li>
              <li class="Sidenav-page">
                <a href="/howto/secrets/" class="Sidenav-pageLink">Secrets</a>
              </li>
            </ul>
        </li>
        <li class="Sidenav-section">
          <a href="/ref/" class="Sidenav-sectionLink">Reference</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/blob/" class="Sidenav-pageLink">blob</a>
              </li>
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/mysql/" class="Sidenav-pageLink">mysql</a>
              </li>
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/postgres/" class="Sidenav-pageLink">postgres</a>
              </li>
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/pubsub/" class="Sidenav-pageLink">pubsub</a>
              </li>
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/runtimevar/" class="Sidenav-pageLink">runtimevar</a>
              </li>
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/secrets/" class="Sidenav-pageLink">secrets</a>
              </li>
              <li class="Sidenav-page Sidenav-refPage">
                <a href="/ref/server/" class="Sidenav-pageLink">server</a>
              </li>
              
            </ul>
        </li>
        <li class="Sidenav-section">
          <a href="/concepts/" class="Sidenav-sectionLink">Concepts</a>
            <ul class="Sidenav-pageList">
              <li class="Sidenav-page">
                <a href="/concepts/structure/" class="Sidenav-pageLink">Structuring Portable Code</a>
              </li>
              <li class="Sidenav-page">
                <a href="/concepts/urls/" class="Sidenav-pageLink">URLs</a>
              </li>
              <li class="Sidenav-page">
                <a href="/concepts/as/" class="Sidenav-pageLink">Using provider-specific APIs</a>
              </li>
              
            </ul>
        </li>
      </ul>
    </nav>
    <footer class="PageFooter">
      <nav>
        <ul class="FooterLinks">
          <li class="FooterLinks-item"><a href="https://github.com/google/go-cloud/" class="FooterLinks-link">GitHub</a></li>
          <li class="FooterLinks-item"><a href="https://groups.google.com/forum/#!forum/go-cloud" class="FooterLinks-link">Google Groups</a></li>
          <li class="FooterLinks-item"><a href="mailto:go-cdk-feedback@google.com" class="FooterLinks-link">Contact Team</a></li>
        </ul>
      </nav>

      <p class="PageFooter-paragraph">
        Copyright Â© 2018â€“2019 The Go Cloud Development Kit Authors.
        All content released under an <a href="https://github.com/google/go-cloud/blob/master/LICENSE" target="_blank" class="PageFooter-link">Apache 2.0 License</a>.
      </p>
      <p class="PageFooter-paragraph"><a href="https://github.com/google/go-cloud/edit/master/internal/website/content/howto/secrets/crypt.md" class="PageFooter-link">Improve this page</a> on GitHub.</p>
    </footer>
  </div>
</body>
</html>
